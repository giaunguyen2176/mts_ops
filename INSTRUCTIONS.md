#Terraform is amazing!

##How to deploy your API backend and/or frontend websites to ECS with Terraform?


###1. Prerequisites

- An AWS account
- A valid domain that you have credentials to login to manage DNS records
- Terraform CLI installed, you can download the installer depends on your OS here: https://www.terraform.io/downloads


###2. Prepare your AWS user and permissions

Because we will use terraform to manage resources from AWS, Terraform requires multiple permissions depends on services or resources you use.

We will use AWS_ACCESS_KEY and AWS_SECRET_ACCESS, to provide Terraform the necessary access to AWS resources.

So heads to AWS console and generate a new pair of AWS_ACCESS_KEY and AWS_SECRET_ACCESS. You can you the root account to generate this pair,
but it's a best practice to limit the permissions one user can use, so its good to just create a new user and generate a new pair from that user.

The user will require many permissions to perform Terraform tasks, skip this step if you use key pair generated from root account and a full permissions user.
Heads to IAM console of AWS and create a new policies: Terraform with below permissions:

<permissions>

###3. Prepare domains for your backend/frontend

We want backend endpoint to looks fancy like: https://api.mts.example.com, not just some random url generated by AWS by default

Heads to AWS Route53 console and create a public hosted zone, for example: mts.example.com. Remember to replace example.com to your owned domain
After the hosted zone is created, notices the value of default NS record created by AWS, something likes:

ns-1455.awsdns-53.org.
ns-1884.awsdns-43.co.uk.
ns-965.awsdns-56.net.
ns-17.awsdns-02.com.

Copy one of above values (without the dot at the end)

Now, heads to DNS management console of your owned domain, create a new DNS record with:

	type 	= NS
	name 	= api
	value 	= the value that you have copied from above, for example: ns-1455.awsdns-53.org

DNS probagation will likely take 1 minute or 2.


To verify that DNS configuration is working, heads to https://dnschecker.org and verify as below:

	value = mts.example.com (again remember to replace example.com to your domain)
	type = NS

The website should present a bunch of green ticks and show you the values corresponding to default NS record created by AWS.

The reason we needs to do this is because we want to have SSL served by our services, and we use Terraform to automatically process with DNS validation on your domain and generated a valid ACM SSL certificate without us doing the manual DNS validation.

###4. Terraform-ing our ECS cluster with all the necessary configuration

Clone the repository mts_ops into your local computer:

`git clone git@github.com:giaunguyen2176/mts_ops.git`

All AWS resources, data, etc were described in this repository

Just open your terminal, cd into the project folder and execute command:

`terraform init`

then:

`terraform apply -var-file=dev.tfvars`


If later, you want to remove all resources, perform this command:

`terraform destroy -var-file=dev.tfvars`

###5. Terraform-ing backend service for our backend:

Clone the repository mts_api into your local computer:

`git clone git@github.com:giaunguyen2176/mts_api.git`

All AWS resources, data, etc, ... related to this backend service, were described in /ops folder

Just open your terminal, cd into /ops folder inside project folder and execute command:

`terraform init`

then:

`terraform apply -var-file=dev.tfvars`


If later, you want to remove all resources, perform this command:

`terraform destroy -var-file=dev.tfvars`